# @package _global_

defaults:
  - /model/gpt2/2.7b

training:
  max_sequence_length: 2048
  vocab_size: 50304
  global_batch_size: 512
  params_dtype: float16
  exec_dtype: float16
  optimizer_dtype: float32
  autocast_enabled: false
  optimizer_name: adamw

hardware:
  gpu_type: null
  num_nodes: 1
  num_gpus_per_node: 4
  inter_node_gpu_gpu_comm_params: [4.193515, 9.6e-05, 0.867748]
  intra_node_gpu_gpu_comm_params: [1.726804, -0.001273, 0.696697]
  cpu_gpu_comm_params: [12.686143, 0.002758]
  gpu_cpu_comm_params: [10.692224, 0.00169]
  interference_model_params: [20.7144, 2.9141, 12.931, 14.095, 6.7863, 8.5577, 1.0593, 17.9384, 2.5234, 12.4777, 1.3581, 1.4628, 2.4114, 3.0539, 13.6618, 14.5992, 1.2826, 1.0, 1.0022, 1.0012, 1.0035, 1.0, 2.0523, 2.0529, 2.7258, 14.5733, 1.7557, 1.7271]
  nvlink: false
  memory_capacity: 22.488

strategy:
  enabled: true
  layer_partitions: [8, 8]
  device_assignment: [[1, 2], [1, 2]]
  # gradient_checkpointing: [16, 16]
  gradient_checkpointing: [0, 0]
  gradient_accumulation_steps: 64
  stage_strategies:
  - [4, 2, 1, 0, 0, 1, 0, 0, 0, 0]
  - [4, 2, 1, 0, 0, 1, 0, 0, 0, 0]
  pre_post_strategy: preset
  pre_post_strategy_array: [4, 2, 1, 0, 0, 1, 0, 0, 0, 0]


tuning:
  enabled: true
  tuning_granularity: no-pp   # no-pp, uniform-pp, inter-stage
  activation_checkpointing_tuning_enabled: false
  state_offloading_enabled: false
  activation_offloading_enabled: false
  # pre_post_strategy: "${strategy.pre_post_strategy}"
  # pre_post_strategy_array: "${strategy.pre_post_strategy_array}"
  pre_post_strategy: dp   # ["dp", "intra-node-tp-with-ore", "intra-node-tp-without-ore"]
  pre_post_strategy_array: null

use_memory_buffer: true

# The following are just for benchmarking
# Whether to use optimizer
use_optim: true
# Whether use ReSwap optimizer
use_re_swap_optim: true
# Which optimizer to use if enable_re_swap is false
optim_impl_if_not_re_swap: apex
# Whether to use zero if not re-swap
use_zero_if_not_re_swap: false

overlap: true
cpu_optim_step: false
cpu_accumu_grad: false

profile: false
tiny_bench: true
memory_debug: false
